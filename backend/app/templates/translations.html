{% extends "base_admin.html" %}

{% block title %}Translations - Knowledge Management System{% endblock %}

{% block content %}
<section class="py-16 bg-ivory-mist dark:bg-heritage-charcoal min-h-screen">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">
        <!-- Header -->
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm uppercase tracking-wide text-clay-taupe">Localization</p>
                <h1 class="font-display font-bold text-4xl text-heritage-charcoal dark:text-ivory-mist">Translations</h1>
                <p class="text-graphite dark:text-warm-sand mt-2">Manage multilingual content across {{ supported_languages|length }} languages.</p>
            </div>
            <a href="/admin/contents/new?lang={{ current_language }}"
               class="inline-flex items-center px-4 py-2 rounded-lg bg-deep-terracotta text-ivory-mist hover:bg-civic-emerald transition-colors text-sm font-semibold">
                + New Content
            </a>
        </div>

        <!-- Filters -->
        <div class="bg-white dark:bg-ink-blue rounded-2xl border border-warm-sand dark:border-graphite shadow-xl p-6">
            <form method="get" class="flex flex-wrap items-end gap-4">
                <input type="hidden" name="lang" value="{{ current_language }}">

                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium text-heritage-charcoal dark:text-warm-sand mb-2">Content Type</label>
                    <select name="type" class="w-full rounded-lg border border-warm-sand dark:border-graphite bg-ivory-mist dark:bg-heritage-charcoal text-sm p-3">
                        <option value="">All Types</option>
                        <option value="article" {% if content_type == 'article' %}selected{% endif %}>Article</option>
                        <option value="guide" {% if content_type == 'guide' %}selected{% endif %}>Guide</option>
                        <option value="tutorial" {% if content_type == 'tutorial' %}selected{% endif %}>Tutorial</option>
                        <option value="faq" {% if content_type == 'faq' %}selected{% endif %}>FAQ</option>
                    </select>
                </div>

                <div class="flex items-center gap-2">
                    <input type="checkbox" name="incomplete" value="true" id="incomplete-filter"
                           {% if show_incomplete %}checked{% endif %}
                           class="rounded border-warm-sand dark:border-graphite">
                    <label for="incomplete-filter" class="text-sm text-heritage-charcoal dark:text-warm-sand">
                        Show only incomplete
                    </label>
                </div>

                <button type="submit"
                        class="px-4 py-2 rounded-lg bg-deep-terracotta text-ivory-mist text-sm hover:bg-civic-emerald">
                    Apply Filters
                </button>
                <a href="?lang={{ current_language }}"
                   class="px-4 py-2 rounded-lg bg-warm-sand dark:bg-graphite text-heritage-charcoal dark:text-ivory-mist text-sm hover:opacity-80">
                    Clear
                </a>
            </form>
        </div>

        <!-- Supported Languages -->
        <div class="bg-white dark:bg-ink-blue rounded-2xl border border-warm-sand dark:border-graphite shadow-xl p-6">
            <h2 class="font-semibold text-heritage-charcoal dark:text-ivory-mist text-lg mb-4">Supported Languages</h2>
            <div class="flex flex-wrap gap-2">
                {% for lang in supported_languages %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-civic-emerald/10 text-civic-emerald border border-civic-emerald/20">
                    {{ lang|upper }}
                </span>
                {% endfor %}
            </div>
        </div>

        <!-- Content List -->
        {% if contents %}
        <div class="space-y-4">
            {% for item in contents %}
            <div class="bg-white dark:bg-ink-blue rounded-2xl border border-warm-sand dark:border-graphite shadow-xl p-6">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-medium bg-clay-taupe/10 text-clay-taupe border border-clay-taupe/20">
                                {{ item.type|title }}
                            </span>
                            <h3 class="font-display font-bold text-xl text-heritage-charcoal dark:text-ivory-mist">
                                {{ item.title }}
                            </h3>
                        </div>
                        <p class="text-sm text-graphite dark:text-warm-sand/80">
                            Created {{ item.created_at }}
                        </p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-heritage-charcoal dark:text-ivory-mist">
                            {{ item.completion_percentage }}%
                        </div>
                        <p class="text-xs text-clay-taupe">{{ item.translation_count }}/{{ item.total_languages }} languages</p>
                    </div>
                </div>

                <!-- Translation Status -->
                <div class="mb-4">
                    <div class="flex items-center gap-2 mb-2">
                        <p class="text-sm font-medium text-heritage-charcoal dark:text-warm-sand">Available:</p>
                        {% for lang in item.available_languages %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs
                                   {% if lang == item.primary_language %}bg-heritage-gold/20 text-heritage-gold border border-heritage-gold/40
                                   {% else %}bg-civic-emerald/10 text-civic-emerald border border-civic-emerald/20{% endif %}">
                            {{ lang|upper }}{% if lang == item.primary_language %} ★{% endif %}
                        </span>
                        {% endfor %}
                    </div>

                    {% if item.missing_languages %}
                    <div class="flex items-center gap-2">
                        <p class="text-sm font-medium text-heritage-charcoal dark:text-warm-sand">Missing:</p>
                        {% for lang in item.missing_languages %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-graphite/10 dark:bg-graphite/30 text-graphite dark:text-warm-sand/60 border border-graphite/20">
                            {{ lang|upper }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- Progress Bar -->
                <div class="mb-4">
                    <div class="w-full bg-warm-sand/30 dark:bg-graphite/30 rounded-full h-2">
                        <div class="bg-civic-emerald h-2 rounded-full transition-all"
                             style="width: {{ item.completion_percentage }}%"></div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-2">
                    <a href="/admin/contents/{{ item.id }}?lang={{ current_language }}"
                       class="px-4 py-2 rounded-lg bg-warm-sand dark:bg-graphite text-heritage-charcoal dark:text-ivory-mist text-sm hover:opacity-80">
                        View Content
                    </a>
                    <p class="text-xs text-clay-taupe ml-auto">
                        Use API: <code class="px-2 py-1 rounded bg-heritage-charcoal/5 dark:bg-graphite/50">POST /api/contents/{{ item.id }}/translations</code>
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="bg-white dark:bg-ink-blue rounded-2xl border border-warm-sand dark:border-graphite shadow-xl p-12 text-center">
            <p class="text-xl text-graphite dark:text-warm-sand mb-4">No content found</p>
            <p class="text-sm text-clay-taupe mb-6">Create content to start managing translations</p>
            <a href="/admin/contents/new?lang={{ current_language }}"
               class="inline-flex items-center px-6 py-3 rounded-lg bg-deep-terracotta text-ivory-mist hover:bg-civic-emerald transition-colors text-sm font-semibold">
                + Create Content
            </a>
        </div>
        {% endif %}

        <!-- API Guide -->
        <div class="bg-white dark:bg-ink-blue rounded-2xl border border-warm-sand dark:border-graphite shadow-xl p-6">
            <h2 class="font-semibold text-heritage-charcoal dark:text-ivory-mist text-lg mb-4">Translation API</h2>
            <div class="space-y-4">
                <div>
                    <p class="text-sm text-graphite dark:text-warm-sand mb-2">Add a translation to existing content:</p>
                    <pre class="bg-heritage-charcoal dark:bg-graphite text-ivory-mist p-4 rounded-lg text-xs overflow-x-auto">POST /api/contents/{content_id}/translations
{
  "language": "de",
  "title": "Python Einführung",
  "markdown": "# Python Einführung\\n\\nPython ist...",
  "is_primary": false
}</pre>
                </div>
                <div>
                    <p class="text-sm text-graphite dark:text-warm-sand mb-2">Update existing translation:</p>
                    <pre class="bg-heritage-charcoal dark:bg-graphite text-ivory-mist p-4 rounded-lg text-xs overflow-x-auto">PUT /api/contents/{content_id}/translations/{language}
{
  "title": "Updated title",
  "markdown": "Updated content..."
}</pre>
                </div>
                <div>
                    <p class="text-sm text-graphite dark:text-warm-sand mb-2">Set primary language:</p>
                    <pre class="bg-heritage-charcoal dark:bg-graphite text-ivory-mist p-4 rounded-lg text-xs overflow-x-auto">POST /api/contents/{content_id}/translations/{language}/set-primary</pre>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
