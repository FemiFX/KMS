{% extends "base_admin.html" %}

{% block title %}Browse Content - Knowledge Management System{% endblock %}

{% block content %}
<section class="py-16 bg-ivory-mist dark:bg-heritage-charcoal min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">
        <!-- Header -->
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm uppercase tracking-wide text-clay-taupe">Library</p>
                <h1 class="font-display font-bold text-4xl text-heritage-charcoal dark:text-ivory-mist">Browse Content</h1>
                <p class="text-graphite dark:text-warm-sand mt-2">{{ total }} item{{ 's' if total != 1 else '' }} found</p>
            </div>
            <a href="/admin/contents/new?lang={{ current_language }}"
               class="inline-flex items-center px-4 py-2 rounded-lg bg-deep-terracotta text-ivory-mist hover:bg-civic-emerald transition-colors text-sm font-semibold">
                + Create Content
            </a>
        </div>

        <!-- Filters -->
        <div class="bg-white dark:bg-ink-blue border border-warm-sand dark:border-graphite rounded-2xl shadow-xl p-6">
            <h2 class="font-semibold text-heritage-charcoal dark:text-ivory-mist text-lg mb-4">Filters</h2>
            <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <input type="hidden" name="lang" value="{{ current_language }}">

                <!-- Content Type Filter -->
                <div>
                    <label class="block text-sm font-medium text-heritage-charcoal dark:text-warm-sand mb-2">Content Type</label>
                    <select name="type" class="w-full rounded-lg border border-warm-sand dark:border-graphite bg-ivory-mist dark:bg-heritage-charcoal text-sm p-3">
                        <option value="">All Types</option>
                        <option value="article" {% if content_type == 'article' %}selected{% endif %}>Article</option>
                        <option value="guide" {% if content_type == 'guide' %}selected{% endif %}>Guide</option>
                        <option value="tutorial" {% if content_type == 'tutorial' %}selected{% endif %}>Tutorial</option>
                        <option value="faq" {% if content_type == 'faq' %}selected{% endif %}>FAQ</option>
                    </select>
                </div>

                <!-- Visibility Filter -->
                <div>
                    <label class="block text-sm font-medium text-heritage-charcoal dark:text-warm-sand mb-2">Visibility</label>
                    <select name="visibility" class="w-full rounded-lg border border-warm-sand dark:border-graphite bg-ivory-mist dark:bg-heritage-charcoal text-sm p-3">
                        <option value="">All</option>
                        <option value="public" {% if visibility == 'public' %}selected{% endif %}>Public</option>
                        <option value="internal" {% if visibility == 'internal' %}selected{% endif %}>Internal</option>
                        <option value="private" {% if visibility == 'private' %}selected{% endif %}>Private</option>
                    </select>
                </div>

                <!-- Tag Filter -->
                <div>
                    <label class="block text-sm font-medium text-heritage-charcoal dark:text-warm-sand mb-2">Tag</label>
                    <select name="tag" class="w-full rounded-lg border border-warm-sand dark:border-graphite bg-ivory-mist dark:bg-heritage-charcoal text-sm p-3">
                        <option value="">All Tags</option>
                        {% for tag in available_tags %}
                        <option value="{{ tag.key }}" {% if tag_filter == tag.key %}selected{% endif %}>{{ tag.default_label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Sort -->
                <div>
                    <label class="block text-sm font-medium text-heritage-charcoal dark:text-warm-sand mb-2">Sort By</label>
                    <select name="sort" class="w-full rounded-lg border border-warm-sand dark:border-graphite bg-ivory-mist dark:bg-heritage-charcoal text-sm p-3">
                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Newest First</option>
                        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>Oldest First</option>
                        <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title A-Z</option>
                    </select>
                </div>

                <!-- Apply Button -->
                <div class="md:col-span-4 flex justify-end gap-2">
                    <a href="?lang={{ current_language }}"
                       class="px-4 py-2 rounded-lg bg-warm-sand dark:bg-graphite text-heritage-charcoal dark:text-ivory-mist text-sm hover:opacity-80">
                        Clear Filters
                    </a>
                    <button type="submit"
                            class="px-4 py-2 rounded-lg bg-deep-terracotta text-ivory-mist text-sm hover:bg-civic-emerald">
                        Apply Filters
                    </button>
                </div>
            </form>
        </div>

        <!-- Content Grid -->
        {% if contents %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for item in contents %}
            <article class="bg-white dark:bg-ink-blue border border-warm-sand dark:border-graphite rounded-2xl shadow-xl hover:shadow-2xl transition-shadow overflow-hidden">
                <div class="p-6">
                    <!-- Header -->
                    <div class="flex items-start justify-between mb-3">
                        <span class="inline-block px-3 py-1 rounded-full text-xs font-medium
                                   {% if item.type == 'article' %}bg-deep-terracotta/10 text-deep-terracotta border border-deep-terracotta/20
                                   {% elif item.type == 'guide' %}bg-civic-emerald/10 text-civic-emerald border border-civic-emerald/20
                                   {% elif item.type == 'tutorial' %}bg-azure-breeze/10 text-azure-breeze border border-azure-breeze/20
                                   {% else %}bg-clay-taupe/10 text-clay-taupe border border-clay-taupe/20{% endif %}">
                            {{ item.type|title }}
                        </span>
                        <span class="text-xs text-clay-taupe">
                            {% if item.visibility == 'public' %}üåç
                            {% elif item.visibility == 'internal' %}üè¢
                            {% else %}üîí{% endif %}
                        </span>
                    </div>

                    <!-- Title -->
                    <h2 class="font-display font-bold text-xl text-heritage-charcoal dark:text-ivory-mist mb-2 line-clamp-2">
                        {{ item.title }}
                    </h2>

                    <!-- Excerpt -->
                    <p class="text-sm text-graphite dark:text-warm-sand/80 mb-4 line-clamp-3">
                        {{ item.excerpt }}
                    </p>

                    <!-- Tags -->
                    {% if item.tags %}
                    <div class="flex flex-wrap gap-2 mb-4">
                        {% for tag in item.tags[:3] %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-warm-sand/20 dark:bg-graphite/30 text-heritage-charcoal dark:text-warm-sand">
                            {{ tag }}
                        </span>
                        {% endfor %}
                        {% if item.tags|length > 3 %}
                        <span class="text-xs text-clay-taupe">+{{ item.tags|length - 3 }} more</span>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Footer -->
                    <div class="flex items-center justify-between pt-4 border-t border-warm-sand dark:border-graphite">
                        <span class="text-xs text-clay-taupe">{{ item.created_at }}</span>
                        <a href="/admin/contents/{{ item.id }}?lang={{ current_language }}"
                           class="text-sm text-deep-terracotta hover:text-civic-emerald font-medium">
                            Read ‚Üí
                        </a>
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="flex items-center justify-center gap-2">
            {% if page > 1 %}
            <a href="?lang={{ current_language }}&type={{ content_type }}&visibility={{ visibility }}&tag={{ tag_filter }}&sort={{ sort_by }}&page={{ page - 1 }}"
               class="px-4 py-2 rounded-lg bg-white dark:bg-ink-blue border border-warm-sand dark:border-graphite text-heritage-charcoal dark:text-ivory-mist hover:bg-warm-sand dark:hover:bg-graphite">
                Previous
            </a>
            {% endif %}

            <span class="px-4 py-2 text-sm text-graphite dark:text-warm-sand">
                Page {{ page }} of {{ total_pages }}
            </span>

            {% if page < total_pages %}
            <a href="?lang={{ current_language }}&type={{ content_type }}&visibility={{ visibility }}&tag={{ tag_filter }}&sort={{ sort_by }}&page={{ page + 1 }}"
               class="px-4 py-2 rounded-lg bg-white dark:bg-ink-blue border border-warm-sand dark:border-graphite text-heritage-charcoal dark:text-ivory-mist hover:bg-warm-sand dark:hover:bg-graphite">
                Next
            </a>
            {% endif %}
        </div>
        {% endif %}

        {% else %}
        <!-- Empty State -->
        <div class="bg-white dark:bg-ink-blue border border-warm-sand dark:border-graphite rounded-2xl shadow-xl p-12 text-center">
            <p class="text-xl text-graphite dark:text-warm-sand mb-4">No content found</p>
            <p class="text-sm text-clay-taupe mb-6">Try adjusting your filters or create new content</p>
            <a href="/admin/contents/new?lang={{ current_language }}"
               class="inline-flex items-center px-6 py-3 rounded-lg bg-deep-terracotta text-ivory-mist hover:bg-civic-emerald transition-colors text-sm font-semibold">
                + Create Content
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
